@model  HZSoft.Application.Entity.CustomerManage.TelphoneLiangH5Entity
<!doctype html>
<html font-size="12px">
<head>
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;" name="viewport" />
    <title>立即订购-号运来靓号 </title>
    <meta name="description" content="">
    <meta name="keyword" content="">
    <link type="text/css" rel="stylesheet" href="https://cdn.staticfile.org/mui/3.7.1/css/mui.min.css">
    <link type="text/css" rel="stylesheet" href="/css/wap/base.css?ver=0.4">

    <!-- Bytedance Tracking -->
    <script>
        (function (r, d, s, l) {
            var meteor = r.meteor = r.meteor || []; meteor.methods = ["track", "off", "on"]; meteor.factory = function (method) {
                return function () {
                    var args = Array.prototype.slice.call(arguments); args.unshift(method); meteor.push(args); return meteor
                }
            }; for (var i = 0; i < meteor.methods.length; i++) {
                var key = meteor.methods[i]; meteor[key] = meteor.factory(key)
            } meteor.load = function () {
                var js, fjs = d.getElementsByTagName(s)[0]; js = d.createElement(s);
                js.src = "https://analytics.snssdk.com/meteor.js/v1/" + l + "/sdk"; fjs.parentNode.insertBefore(js, fjs)
            }; meteor.load(); if (meteor.invoked) { return }
            meteor.invoked = true; meteor.track("pageview")
        })(window, document, "script", "1668530965859335");
    </script>
    <!-- End Bytedance Tracking -->

</head>
<body>
    <div class="main">
        <link href="/css/wap/create-order.css?v=0.2" rel="stylesheet" type="text/css">
        <link href="/css/wap/pay-order.css?v=0.1" rel="stylesheet" type="text/css">
        <div class="mui-card phone-info">
            <div class="mui-card-content">
                <div class="mobile-box">
                    <span class="phone-number mobile-box-span">@Model.Telphone</span>
                    <span class="phone-loc mobile-box-span">
                        <span>@Model.City</span>
                        <span>(@Model.Brand)</span>
                    </span>
                </div>

                <div class="price-box">
                    <div class="price-box-div">
                        <span class="price-box-div-span price-box-span-title">价格</span>
                        <span class="price-box-div-span price-box-span-text">￥@Model.Price</span>
                    </div>
                    <div class="price-box-div">
                        <span class="price-box-div-span price-box-span-title">话费</span>
                        <span class="price-box-div-span price-box-span-text">0元</span>
                    </div>
                    <div class="price-box-div">
                        <span class="price-box-div-span price-box-span-title">预充</span>
                        <span class="price-box-div-span price-box-span-text">0元</span>
                    </div>
                    <div class="clear"></div>
                </div>
                <div class="phone-intro-box">
                    <div class="phone-intro-title phone-intro-box-div">
                        套餐说明
                    </div>
                    <div class="phone-intro-content">
                        @Model.Package
                    </div>
                </div>
            </div>
        </div>
        <div class="mui-card">

            <div class="ordertitle">订单信息</div>
            <div class="mui-card-content">
                <form class="mui-input-group customer-info">
                    <div class="mui-input-row">
                        <label>姓名(必填)</label>
                        <input type="text" class="mui-input-clear name " placeholder="请输入真实姓名" required="" data-input-clear="1"><span class="mui-icon mui-icon-clear mui-hidden"></span>
                    </div>




                    <div class="mui-input-row">
                        <label>手机(必填)</label>
                        <input type="text" class="mui-input-clear mobile" placeholder="输入您的电话" maxlength="11" data-input-clear="3"><span class="mui-icon mui-icon-clear mui-hidden"></span>
                    </div>
                    <div class="mui-input-row">
                        <label>城市(必填)</label>
                        <input type="text" class="select-city" placeholder="选择城市" readonly value="广东省-广州市-天河区">
                    </div>
                    <div class="mui-input-row">
                        <label>详细地址(必填)</label>
                        <input type="text" class="mui-input-clear address" placeholder="请输入您的小区地址" data-input-clear="5"><span class="mui-icon mui-icon-clear mui-hidden"></span>
                    </div>
                    <div class="mui-input-row">
                        <label>备注信息</label>
                        <input type="text" class="mui-input-clear remark" placeholder="备注信息" data-input-clear="6"><span class="mui-icon mui-icon-clear mui-hidden"></span>
                    </div>
                </form>
            </div>

            <div class="gateway-box">
                <div class="mui-card-content">
                    <span class="gateway-span  gateway-title">支付方式</span>
                    <span class="gateway-span gateway alipay selected" data-value="alipay"><img src="/imgs/alipay.png"><span class="gateway-text">支付宝</span></span>
                </div>
            </div>
        </div>

        <div class="details_poto">
            <img src="/imgs/det_img01.jpg">
            <img src="/imgs/det_img02.jpg">




            <img src="/imgs/det_img07.jpg">
            <img src="/imgs/det_img08.jpg">
        </div>


        <div class="order-footer">
            <span class="order-price">￥@Model.Price</span>
            <span class="order-submit">立即购买</span>
            <div class="clear"></div>
        </div>


        <div class="param-loc-div param-div">
            <ul class="mui-table-view param-ul param-province-ul">
                <li class="mui-table-view-cell">选择省</li>
            </ul>
            <ul class="mui-table-view  param-ul  param-city-ul">
                <li class="mui-table-view-cell">选择城市</li>
            </ul>
            <ul class="mui-table-view  param-ul  param-district-ul">
                <li class="mui-table-view-cell">选择乡镇区</li>
            </ul>
            <div class="clear"></div>
        </div>

    </div>
    <div class="mask" style="display: none;"></div>
    <!--遮罩层-->
    <div class="mask_dl" style="display:none;">
        <p><img src="/imgs/loading_c.gif"></p>
    </div>



    </div>
    <div class="mask"></div>
    <div style="display: none;">
        <script type="text/javascript" src="https://s4.cnzz.com/z_stat.php?id=1278862551&web_id=1278862551"></script>
    </div>
    <script src="https://cdn.staticfile.org/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/mui/3.7.1/js/mui.min.js"></script>

    <link rel="stylesheet" href="/themes/simplebootx_mobile/Public/css/weui.min.css">
    <script src="/themes/simplebootx_mobile/Public/js/jquery-weui.min.js"></script>

    <script>
        function cl(str) {
            console.log(str);
        }
        function toast(str) {
            mui.toast(str);
        }

        function setCookie(name, value, domain = '') {
            var Days = 1000;
            var exp = new Date();
            exp.setTime(exp.getTime() + Days * 24 * 60 * 60 * 1000);

            if (domain == '') {
                document.cookie = name + "=" + escape(value) + ";expires=" + exp.toGMTString();
            } else {
                document.cookie = name + "=" + escape(value) + ";expires=" + exp.toGMTString() + ";domain=." + domain;
            }

        }

        function getCookie(name) {
            var arr, reg = new RegExp("(^| )" + name + "=([^;]*)(;|$)");

            if (arr = document.cookie.match(reg))

                return unescape(arr[2]);
            else
                return null;
        }

        function getQueryVariable(variable) {
            var query = window.location.search.substring(1);
            var vars = query.split("&");
            for (var i = 0; i < vars.length; i++) {
                var pair = vars[i].split("=");
                if (pair[0] == variable) { return pair[1]; }
            }
            return '';
        }
    </script>

    <script>
        function cl(str) {
            console.log(str);
        }
        function toast(str) {
            mui.toast(str);
        }

        function setCookie(name, value, domain = '') {
            var Days = 1000;
            var exp = new Date();
            exp.setTime(exp.getTime() + Days * 24 * 60 * 60 * 1000);

            if (domain == '') {
                document.cookie = name + "=" + escape(value) + ";expires=" + exp.toGMTString();
            } else {
                document.cookie = name + "=" + escape(value) + ";expires=" + exp.toGMTString() + ";domain=." + domain;
            }

        }

        function getCookie(name) {
            var arr, reg = new RegExp("(^| )" + name + "=([^;]*)(;|$)");

            if (arr = document.cookie.match(reg))

                return unescape(arr[2]);
            else
                return null;
        }

        function getQueryVariable(variable) {
            var query = window.location.search.substring(1);
            var vars = query.split("&");
            for (var i = 0; i < vars.length; i++) {
                var pair = vars[i].split("=");
                if (pair[0] == variable) { return pair[1]; }
            }
            return '';
        }
    </script>

    <script>
        $('.back-to-index').click(function () {
            window.history.back();
        });
        $('.service-left').click(function () {
            if ($('.service').hasClass('service-close')) {
                $('.service').animate({ 'left': '30%' }, 500);
                $('.service').removeClass('service-close');
            } else {
                $('.service').animate({ 'left': '80%' }, 500);
                $('.service').addClass('service-close');
            }
        });


        $('document').ready(function () {
            $.getScript('https://apis.map.qq.com/ws/location/v1/ip?key=AICBZ-VCXKU-PGXV6-2EQJU-GXN3F-LSF64&output=jsonp&callback=autoCity');
            $.ajax({
                url: 'https://datavmap-public.oss-cn-hangzhou.aliyuncs.com/areas/csv/100000_province.json',
                type: 'get',
                success: function (res) {
                    let target = $('.param-province-ul');
                    let tpl = '<li class="mui-table-view-cell param-province-li param-province-li-append" data-id ="__NAME__" data-pcode="__PID__">__NAME__</li>';
                    $.each(res.rows, function (i, v) {
                        let lihtml = tpl.replace(/__PID__/, v.adcode);
                        lihtml = lihtml.replace(/__NAME__/g, v.name);
                        target.append(lihtml);
                    });
                }
            });
            //选择城市
            $('.select-city').click(function () {
                $('.mask').show();
                $('.param-loc-div').fadeIn(200);
                $(this).parent('.mui-input-row').removeClass('input-error');
            })
            //省份
            $('.param-province-ul').on('click', '.param-province-li', function () {
                let pcode = $(this).attr('data-pcode');
                $('.param-province-li').removeClass('province-li-active');
                $(this).addClass('province-li-active');

                $.ajax({
                    url: 'https://datavmap-public.oss-cn-hangzhou.aliyuncs.com/areas/csv/' + pcode + '_city.json',
                    type: 'get',
                    success: function (res) {
                        let target = $('.param-city-ul');
                        let tpl = '<li class="mui-table-view-cell  param-city-li param-city-li-render" data-id = "__NAME__" data-pcode="__CID__">__NAME__</li>';
                        let html = '';
                        $.each(res.rows, function (i, v) {
                            let lihtml = tpl.replace(/__NAME__/g, v.name);
                            lihtml = lihtml.replace(/__CID__/g, v.adcode);
                            html += lihtml;
                        });
                        target.empty();
                        target.append(html);
                    }
                });
            });

            //城市
            $('.param-city-ul').on('click', '.param-city-li', function () {
                let pcode = $(this).attr('data-pcode');
                $('.param-city-li').removeClass('city-li-active');
                $(this).addClass('city-li-active');

                $.ajax({
                    url: 'https://datavmap-public.oss-cn-hangzhou.aliyuncs.com/areas/csv/' + pcode + '_district.json',
                    type: 'get',
                    success: function (res) {
                        let target = $('.param-district-ul');
                        let tpl = '<li class="mui-table-view-cell  param-district-li param-district-li-render" data-id = "__NAME__" data-pcode="__CID__">__NAME__</li>';
                        let html = '';
                        $.each(res.rows, function (i, v) {
                            let city = $('.city-li-active').attr('data-id');
                            if (v.parent == city) {
                                let lihtml = tpl.replace(/__NAME__/g, v.name);
                                lihtml = lihtml.replace(/__CID__/g, v.adcode);
                                html += lihtml;
                            }

                        });
                        target.empty();
                        target.append(html);
                    }
                });
            });

            $('.param-district-ul').on('click', '.param-district-li', function () {
                let province = $('.province-li-active').attr('data-id');
                let city = $('.city-li-active').attr('data-id');
                let district = $(this).attr('data-id');
                changeCity(province + '-' + city + '-' + district);
                $('.mask').hide();
                $('.param-loc-div').fadeOut(300);
            });

            $('.mask').click(function () {
                if ($('.param-loc-div').is(':visible')) {
                    $('.mask').hide();
                    $('.param-loc-div').fadeOut(300);
                }
            });


            $('input').focus(function () {
                $(this).parent('.mui-input-row').removeClass('input-error');
            });


            $('.order-submit').click(function () {
                document.body.scrollTop = document.documentElement.scrollTop = 0

                let name = $('.name').val();
                let mobile = $('.mobile').val();
                // let cardid = $('.cardid').val();
                let city = $('.select-city').val();
                let address = $('.address').val();
                let remark = $('.remark').val();

                if (name == '') {
                    toast('请输入您的姓名');
                    $('.name').parent('.mui-input-row').addClass('input-error');
                    return false;
                }

                if (!(/^1[3456789]\d{9}$/.test(mobile))) {
                    toast('请输入正确手机号');
                    $('.mobile').parent('.mui-input-row').addClass('input-error');
                    return false;
                }

                if (city == '') {
                    toast('请选择您的城市');
                    $('.select-city').parent('.mui-input-row').addClass('input-error');
                    return false;
                }
                if (address == '') {
                    toast('请填写您的地址');
                    $('.address').parent('.mui-input-row').addClass('input-error');
                    return false;
                }
                $('.mask_dl').show();
                $.ajax({
                    url: "/webapp/jinan2/ajaxorder",
                    type: 'post',
                    dataType: 'json',
                    data: {
                        TelphoneID: @Model.TelphoneID,Receiver: name, ContactTel: mobile, city: city, address: address, remark: remark,
                        PayType: gateway,
                        Tel:@Model.Telphone,
                        Price:@Model.Price,
                        PC: IsPC(),
                        Host: '@ViewBag.host',
                        TouUrl: document.referrer
                    },
                    cache: false,
                    async: false,
                    dataType: "json",
                    success: function (resObj) {
                        if (resObj.status) {
                            //头条推广转化（点击支付）
                            //埋点
                            meteor.track("form", { convert_id: "1668534341012483" })
                            //不做处理，跳转
                            if (resObj.data.target) {
                                location.href = resObj.data.gotoUrl;
                                return false;
                            }
                            //支付宝
                            if (gateway == 'alipay') {
                                //输出提交表单
                                $("body").append(resObj.data.form);
                            }
                            //微信
                            if (gateway == 'wechat') {
                                //H5支付
                                if (typeof (resObj.data.mweb_url) != "undefined" && resObj.data.mweb_url != null) {
                                    location.href = resObj.data.mweb_url + '&redirect_url=' + encodeURIComponent(resObj.data.wx_query_over);
                                    return false;
                                }
                                //扫码支付
                                var qrsrc = '<img src="/WeChatManage/user_index/getPageqr/?pageurl=' + encodeURIComponent(resObj.data.code_url) + '" style="max-width:100%;" />';
                                $.modal({
                                    text: qrsrc,
                                    buttons: [
                                        { text: "取消支付", className: "default", onClick: function () { $.hideLoading(); } },
                                        { text: "支付完成", onClick: function () { location.href = '/webapp/jinan2/paymentFinish/' + resObj.data.payid; } }
                                    ]
                                });
                                //检测付款状态
                                setInterval(function () {
                                    $.ajax({
                                        type: "post",
                                        url: resObj.data.wx_query_href,
                                        data: '',
                                        dataType: 'json',
                                        success: function (result) {
                                            if (result.status) {
                                                //支付成功
                                                location.href = resObj.data.wx_query_over;
                                            } else {
                                                console.log("等待付款");
                                            }
                                        }
                                    });
                                }, 2000);
                            }
                        } else {
                            $.hideLoading();
                            //状态显示
                            $.toptip(resObj.msg, resObj.status ? 'success' : 'error');
                        }
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        $.toast("提交失败，请重试", "forbidden");
                    }
                });
            });

            var gateway = "alipay";
            $('.gateway').click(function () {
                let obj = $(this);
                obj.addClass('selected');
                obj.removeClass('not-selected');
                obj.siblings('.gateway').addClass('not-selected');
                gateway = $(this).attr('data-value');
            });

        });

        function inputError(obj) {
            obj.parent('.mui-input-row').addClass('input-error');
        }

        function autoCity(res) {

            if (!res.hasOwnProperty('status')) {
                return false;
            }
            if (!res.hasOwnProperty('result')) {
                return false;
            }

            let locinfo = res.result.ad_info;

            if (locinfo.province != '' && locinfo.city != '') {
                if (locinfo.hasOwnProperty('district')) {
                    changeCity(locinfo.province + '-' + locinfo.city + '-' + locinfo.district);
                } else {
                    changeCity(locinfo.province + '-' + locinfo.city);
                }

            }
        }

        function changeCity(str) {
            $('.select-city').val(str);
        }




        function IsPC() {
            var flag = 1;
            //平台、设备和操作系统
            var system = {
                win: false,
                mac: false,
                xll: false,
                ipad: false
            };
            //检测平台
            var p = navigator.platform;
            system.win = p.indexOf("Win") == 0;
            system.mac = p.indexOf("Mac") == 0;
            system.x11 = (p == "X11") || (p.indexOf("Linux") == 0);
            system.ipad = (navigator.userAgent.match(/iPad/i) != null) ? true : false;
            //跳转语句，如果是PC访问就自动跳转到所要访问的页面http://www.电脑.com
            if (system.win || system.mac || system.xll || system.ipad) {
                //默认访问http://www.电脑.com
            } else {
                //window.location.href = "http://www.手机.com/";
                flag = 0;
            }
            return flag;
        }

    </script>

</body>
</html>
